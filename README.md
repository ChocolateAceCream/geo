
# Geo
A Ruby on Rails backend to support CRUD operations for geolocation data.

## API Endpoints
Please refer to the `api.md` for details. If you want to try sending requests to endpoints, use `api.html`. Both files are generated by ApiFox, my personal favorite replacement for Postman.

### Note:
For GET and DELETE requests, the parameters need to be encoded like this:

```js
// First, wrap in a JSON object
let params = {
  "host": "google.com"
}
url = actualEndpointUrl + '?params=' + encodeURIComponent(JSON.stringify(params))
```

Example:
`http://52.52.54.255:3000/geolocations?params=%7B%22host%22%3A%22google.com%22%7D`

## Deployment
I use Docker & Docker Compose to deploy the app.

First, clone the repo to your local machine, then run:

```bash
sudo docker-compose up -d
```

This command should be run in the root directory of the repo, and it will start the app in production mode.

I also deployed it on my EC2 instance:
http://52.52.54.255:3000/geolocations

Remember to change the `IPSTACK_ACCESS_KEY` environment variable in `docker-compose.yml` to your own, as mine can only send 100 requests for free.

## Logs
If deployed using Docker, logs are located in the `/docker/log` folder.

## TODO
Usually, I like to wrap my responses like this:
```json
{
  "errorCode": 0,
  "msg": "success",
  "data": {}
}

{
  "errorCode": 1,
  "msg": "fail",
}
```
This way, the frontend can handle errors in the global response interceptor and raise an error message or take appropriate action.

# Dev Logs
I like to write daily logs!

## 2024-08-15
Fresh new start! I haven't touched Rails/Ruby for a long time and kind of miss the joy of writing Ruby code. No matter what, Ruby was the first language I picked up on my programming journey.

### First things first, setups:
- [x] Initialize project
- [x] Initialize git
- [x] Initialize database
- [x] Set up Docker
- [x] Set up RSpec

Wow, Rails 7 and Ruby 3! I still remember the first time I started a Rails project; I was using Rails 4 and Ruby 1.x. How time flies!

Luckily, I still have Ruby/Rails installed in my WSL, but I’m not sure why when I initialized the project, I saw this:

```bash
Ignoring nokogiri-1.15.5 because its extensions are not built. Try: gem pristine nokogiri --version 1.15.5
Ignoring nokogiri-1.10.10 because its extensions are not built. Try: gem pristine nokogiri --version 1.10.10
```

It might be because I haven't used it for a long time.
ChatGPT suggested running:
```bash
gem pristine nokogiri --version 1.10.10
```

This fixed the issue.

### P.S.
Speaking of AI and ChatGPT, it's a great tool to use and has pretty much replaced Google search for me. Our human brains have memory limits, and by nature, it erases unimportant stuff.

### Database
I looked up geolocation data formats and did not see any strong relationships between fields, so I plan to use MongoDB to store the data. For convenience, I’m using Docker and Docker Compose for a MongoDB service. Also, using Mongoid means I don't need to use ActiveRecord.

### RSpec
TDD is a common approach in Rails. I remember when I first started learning Rails, every book, tutorial, and blog was focused on TDD. However, later when I started working as a developer, I often wrote tests last because of tight schedules.

Setting up RSpec with the mongoid-rspec gem and Mongoid is straightforward. The only thing I noticed is that RSpec is currently using Ruby 2.7.

Pretty much set up everything today. Let's call it a night.

## 2024-08-16
### Plan for today:
- [x] Implement geolocation API endpoints (GET, POST, DELETE)
- [x] Testing and test data preparation
- [ ] Documentation
- [ ] Docker

I don't plan to implement authentication; that's something the API gateway should handle.

After writing Go for years and switching back to Ruby, I now appreciate how Go handles errors. The way Go handles errors forces developers to think ahead of the logic implementation and deal with errors first.

Regarding system design, a tricky question I’m facing right now is how to deal with IP addresses and hostnames. There might be a chance that different hostnames (like subdomains) may point to the same IP address. I have two options to handle this situation:
1. Use an array to hold all hostnames that point to that IP address. However, I need to be careful when adding a new record with a hostname. I will need to remove that hostname from any existing record's hostname array first (if the IP is not the same).
2. Add a new field 'host', which can either be an IP address or a hostname.

The first approach will save storage space but add computational overhead, while the second one is vice versa.

I will go with the second approach for now, as its logic is more straightforward.

After setting up some test cases and endpoints, the project’s functionality is almost done!

I plan to finish the documentation and deployment tomorrow. After all, it’s Friday night!

## 2024-08-17
### Plan for today:
- [x] Docker
- [x] Documentation

Done!
